var HealthTracker=HealthTracker||{};HealthTracker.Views=function(){"use strict";var t,e,a,o={"x-app-id":"fff9731b","x-app-key":"a9c550a6a475c562adf3ecfa44ec748a"},i=HealthTracker.Models,l=HealthTracker.Templates,n=HealthTracker.Collections,s=Backbone.View.extend({el:".js-food-search",events:{"keydown .search":"searchFoods"},initialize:function(){this.search=this.$el.find(".search"),this.foodChoices=this.$el.find(".food-choices"),this.searchFoodCollection=new n.SearchFoodCollection,this.on({foodselected:this.clearSearch})},render:function(){var t,e=this;e.foodChoices.html(""),this.searchFoodCollection.each(function(a){t=new r({model:a}),e.foodChoices.append(t.render().el)})},searchFoods:_.debounce(function(t){var e=this,a=this.search.val().trim();return e.searchFoodCollection.reset(),a?void $.ajax("https://trackapi.nutritionix.com/v2/search/instant",{method:"GET",data:{query:a,self:!1,branded:!1},headers:o}).done(function(t){var a,o=t.common;_.forEach(o,function(t){a=new i.FoodItem({name:t.food_name,thumbnailURL:t.photo.thumb}),e.searchFoodCollection.add(a)}),e.render()}).fail(function(){e.render()}):void this.clearSearch()},400),clearSearch:function(){this.search.val(""),this.searchFoodCollection.reset(),this.foodChoices.html("")}}),r=Backbone.View.extend({tagName:"li",events:{click:"select"},template:_.template(l.foodSearchDropDownOption),render:function(){return this.$el.html(this.template(this.model.attributes)),this},select:function(){var e=this.model.get("name");$.ajax("https://trackapi.nutritionix.com/v2/natural/nutrients/",{method:"POST",data:{query:e,num_servings:1},headers:o}).done(function(e){var o=e.foods[0],l=new i.FoodItem({name:o.food_name,calories:Math.round(o.nf_calories),fat:Math.round(o.nf_total_fat),thumbnailURL:o.photo.thumb});a.add(l),a.saveToLocalStorage(),t.trigger("foodselected")}).fail(function(){})}}),h=Backbone.View.extend({el:".js-food-list",initialize:function(){this.listenTo(a,"add",this.render)},render:function(t){var e=new c({model:t});this.$el.append(e.render().el)}}),c=Backbone.View.extend({tagName:"li",template:_.template(l.foodListItem),events:{"click .food-list__remove":"removeFoodItem"},render:function(){return this.$el.html(this.template(this.model.attributes)),this},removeFoodItem:function(){a.remove(this.model),this.$el.remove(),a.saveToLocalStorage()}}),d=Backbone.View.extend({el:"#health-tracker",initialize:function(){this.totalCaloriesEl=this.$el.find(".total-calories"),this.totalFatEl=this.$el.find(".total-fat"),this.totalCalories=0,this.totalFat=0,a=new n.FoodCollection,t=new s,e=new h,this.listenTo(a,"add",this.addStats),this.listenTo(a,"remove",this.subStats);var o=localStorage.getItem("healthTrackerFoodList");o&&this.loadState(o),this.render()},render:function(){this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFatEl.html(this.totalFat+" g")},addStats:function(t){this.totalCalories+=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat+=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},subtractStats:function(t){this.totalCalories-=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat-=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},loadState:function(t){var e,o=JSON.parse(t);_.forEach(o,function(t){e=new i.FoodItem({name:t.name,calories:t.calories,fat:t.fat,thumbnailURL:t.thumbnailURL}),a.add(e)})}}),f=function(){new d};return{init:f}}(),HealthTracker.Views.init();