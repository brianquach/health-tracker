var HealthTracker=HealthTracker||{};HealthTracker.Views=function(){"use strict";var t,e,a,o={"x-app-id":"fff9731b","x-app-key":"a9c550a6a475c562adf3ecfa44ec748a"},i=HealthTracker.Models,r=HealthTracker.Templates,s=HealthTracker.Collections,l=Backbone.View.extend({el:".js-food-search",events:{"keydown .search":"searchFoods"},initialize:function(){this.search=this.$el.find(".search"),this.foodChoices=this.$el.find(".food-choices"),this.searchFoodCollection=new s.SearchFoodCollection,this.searchErrorMsg=this.$el.find(".js-search-error").hide(),this.itemSearchErrorMsg=this.$el.find(".js-item-search-error").hide(),this.on({foodselected:this.clearSearch,itemsearcherror:this.itemSearchError})},render:function(){var t,e=this;e.foodChoices.html(""),this.searchFoodCollection.each(function(a){t=new n({model:a}),e.foodChoices.append(t.render().el)})},searchFoods:_.debounce(function(t){var e=this,a=this.search.val().trim();return e.searchFoodCollection.reset(),a?void $.ajax("https://trackapi.nutritionix.com/v2/search/instant",{method:"GET",data:{query:a,self:!1,branded:!1},headers:o}).done(function(t){var a,o=t.common;_.forEach(o,function(t){a=new i.FoodItem({name:t.food_name,thumbnailURL:t.photo.thumb}),e.searchFoodCollection.add(a)}),e.render()}).fail(function(){e.searchErrorMsg.show(),e.render()}):void this.clearSearch()},400),clearSearch:function(){this.search.val(""),this.searchFoodCollection.reset(),this.foodChoices.html("")},itemSearchError:function(){this.itemSearchErrorMsg.show(),this.clearSearch()}}),n=Backbone.View.extend({tagName:"li",events:{click:"select"},template:_.template(r.foodSearchDropDownOption),render:function(){return this.$el.html(this.template(this.model.attributes)),this},select:function(){var e=this.model.get("name");$.ajax("https://trackapi.nutritionix.com/v2/natural/nutrients/",{method:"POST",data:{query:e,num_servings:1},headers:o}).done(function(e){var o=e.foods[0],r=new i.FoodItem({name:o.food_name,calories:Math.round(o.nf_calories),fat:Math.round(o.nf_total_fat),thumbnailURL:o.photo.thumb});a.add(r),a.saveToLocalStorage(),t.trigger("foodselected")}).fail(function(){t.trigger("itemsearcherror")})}}),h=Backbone.View.extend({el:".js-food-list",initialize:function(){this.listenTo(a,"add",this.render)},render:function(t){var e=new c({model:t});this.$el.append(e.render().el)}}),c=Backbone.View.extend({tagName:"li",template:_.template(r.foodListItem),events:{"click .food-list__remove":"removeFoodItem"},render:function(){return this.$el.html(this.template(this.model.attributes)),this},removeFoodItem:function(){a.remove(this.model),this.$el.remove(),a.saveToLocalStorage()}}),d=Backbone.View.extend({el:"#health-tracker",initialize:function(){this.totalCaloriesEl=this.$el.find(".total-calories"),this.totalFatEl=this.$el.find(".total-fat"),this.totalCalories=0,this.totalFat=0,a=new s.FoodCollection,t=new l,e=new h,this.listenTo(a,"add",this.addStats),this.listenTo(a,"remove",this.subtractStats);var o=localStorage.getItem("healthTrackerFoodList");o&&this.loadState(o),this.render()},render:function(){this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFatEl.html(this.totalFat+" g")},addStats:function(t){this.totalCalories+=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat+=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},subtractStats:function(t){this.totalCalories-=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat-=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},loadState:function(t){var e,o=JSON.parse(t);_.forEach(o,function(t){e=new i.FoodItem({name:t.name,calories:t.calories,fat:t.fat,thumbnailURL:t.thumbnailURL}),a.add(e)})}}),m=function(){new d};return{init:m}}(),HealthTracker.Views.init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZXdzLmpzIl0sIm5hbWVzIjpbIkhlYWx0aFRyYWNrZXIiLCJWaWV3cyIsInNlYXJjaFZpZXciLCJmb29kTGlzdFZpZXciLCJmb29kQ29sbGVjdGlvbiIsIm51dHJpdGlvbml4SGVhZGVyIiwieC1hcHAtaWQiLCJ4LWFwcC1rZXkiLCJIVE1vZGVscyIsIk1vZGVscyIsIkhUVGVtcGxhdGVzIiwiVGVtcGxhdGVzIiwiSFRDb2xsZWN0aW9ucyIsIkNvbGxlY3Rpb25zIiwiU2VhcmNoVmlldyIsIkJhY2tib25lIiwiVmlldyIsImV4dGVuZCIsImVsIiwiZXZlbnRzIiwia2V5ZG93biAuc2VhcmNoIiwiaW5pdGlhbGl6ZSIsInRoaXMiLCJzZWFyY2giLCIkZWwiLCJmaW5kIiwiZm9vZENob2ljZXMiLCJzZWFyY2hGb29kQ29sbGVjdGlvbiIsIlNlYXJjaEZvb2RDb2xsZWN0aW9uIiwic2VhcmNoRXJyb3JNc2ciLCJoaWRlIiwiaXRlbVNlYXJjaEVycm9yTXNnIiwib24iLCJmb29kc2VsZWN0ZWQiLCJjbGVhclNlYXJjaCIsIml0ZW1zZWFyY2hlcnJvciIsIml0ZW1TZWFyY2hFcnJvciIsInJlbmRlciIsImZvb2RJdGVtIiwic2VsZiIsImh0bWwiLCJlYWNoIiwiZiIsIlNlYXJjaEl0ZW1WaWV3IiwibW9kZWwiLCJhcHBlbmQiLCJzZWFyY2hGb29kcyIsIl8iLCJkZWJvdW5jZSIsImUiLCJxdWVyeSIsInZhbCIsInRyaW0iLCJyZXNldCIsIiQiLCJhamF4IiwibWV0aG9kIiwiZGF0YSIsImJyYW5kZWQiLCJoZWFkZXJzIiwiZG9uZSIsInJlc3AiLCJmb29kSXRlbXMiLCJjb21tb24iLCJmb3JFYWNoIiwiRm9vZEl0ZW0iLCJuYW1lIiwiZm9vZF9uYW1lIiwidGh1bWJuYWlsVVJMIiwicGhvdG8iLCJ0aHVtYiIsImFkZCIsImZhaWwiLCJzaG93IiwidGFnTmFtZSIsImNsaWNrIiwidGVtcGxhdGUiLCJmb29kU2VhcmNoRHJvcERvd25PcHRpb24iLCJhdHRyaWJ1dGVzIiwic2VsZWN0IiwiZ2V0IiwibnVtX3NlcnZpbmdzIiwiZm9vZCIsImZvb2RzIiwiY2Fsb3JpZXMiLCJNYXRoIiwicm91bmQiLCJuZl9jYWxvcmllcyIsImZhdCIsIm5mX3RvdGFsX2ZhdCIsInNhdmVUb0xvY2FsU3RvcmFnZSIsInRyaWdnZXIiLCJGb29kTGlzdFZpZXciLCJsaXN0ZW5UbyIsImZvb2RMaXN0SXRlbVZpZXciLCJGb29kTGlzdEl0ZW1WaWV3IiwiZm9vZExpc3RJdGVtIiwiY2xpY2sgLmZvb2QtbGlzdF9fcmVtb3ZlIiwicmVtb3ZlRm9vZEl0ZW0iLCJyZW1vdmUiLCJBcHAiLCJ0b3RhbENhbG9yaWVzRWwiLCJ0b3RhbEZhdEVsIiwidG90YWxDYWxvcmllcyIsInRvdGFsRmF0IiwiRm9vZENvbGxlY3Rpb24iLCJhZGRTdGF0cyIsInN1YnRyYWN0U3RhdHMiLCJzdG9yZWRTdGF0ZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJsb2FkU3RhdGUiLCJzdGF0ZSIsIkpTT04iLCJwYXJzZSIsImZpIiwiaW5pdCJdLCJtYXBwaW5ncyI6IkFBSUEsR0FBSUEsZUFBZ0JBLGlCQVVwQkEsZUFBY0MsTUFBUSxXQUNwQixZQUVBLElBUUlDLEdBQ0FDLEVBQ0FDLEVBVkFDLEdBQ0ZDLFdBQVksV0FDWkMsWUFBYSxvQ0FFWEMsRUFBV1IsY0FBY1MsT0FDekJDLEVBQWNWLGNBQWNXLFVBQzVCQyxFQUFnQlosY0FBY2EsWUFhOUJDLEVBQWFDLFNBQVNDLEtBQUtDLFFBQzdCQyxHQUFJLGtCQUVKQyxRQUNFQyxrQkFBbUIsZUFHckJDLFdBQVksV0FDVkMsS0FBS0MsT0FBU0QsS0FBS0UsSUFBSUMsS0FBSyxXQUM1QkgsS0FBS0ksWUFBY0osS0FBS0UsSUFBSUMsS0FBSyxpQkFDakNILEtBQUtLLHFCQUF1QixHQUFJZixHQUFjZ0IscUJBQzlDTixLQUFLTyxlQUFpQlAsS0FBS0UsSUFBSUMsS0FBSyxvQkFBb0JLLE9BQ3hEUixLQUFLUyxtQkFBcUJULEtBQUtFLElBQUlDLEtBQUsseUJBQXlCSyxPQUVqRVIsS0FBS1UsSUFDSEMsYUFBZ0JYLEtBQUtZLFlBQ3JCQyxnQkFBbUJiLEtBQUtjLG1CQUk1QkMsT0FBUSxXQUNOLEdBQUlDLEdBQ0FDLEVBQU9qQixJQUNYaUIsR0FBS2IsWUFBWWMsS0FBSyxJQUN0QmxCLEtBQUtLLHFCQUFxQmMsS0FBSyxTQUFTQyxHQUN0Q0osRUFBVyxHQUFJSyxJQUFpQkMsTUFBT0YsSUFDdkNILEVBQUtiLFlBQVltQixPQUFPUCxFQUFTRCxTQUFTbkIsT0FJOUM0QixZQUFhQyxFQUFFQyxTQUFTLFNBQVNDLEdBQy9CLEdBQUlWLEdBQU9qQixLQUNQNEIsRUFBUTVCLEtBQUtDLE9BQU80QixNQUFNQyxNQUk5QixPQUZBYixHQUFLWixxQkFBcUIwQixRQUVyQkgsTUFLTEksR0FBRUMsS0FBSyxzREFDTEMsT0FBUSxNQUNSQyxNQUNFUCxNQUFPQSxFQUNQWCxNQUFNLEVBQ05tQixTQUFTLEdBRVhDLFFBQVN0RCxJQUNSdUQsS0FBSyxTQUFTQyxHQUNmLEdBQUl2QixHQUNBd0IsRUFBWUQsRUFBS0UsTUFDckJoQixHQUFFaUIsUUFBUUYsRUFBVyxTQUFTcEIsR0FDNUJKLEVBQVcsR0FBSTlCLEdBQVN5RCxVQUN0QkMsS0FBTXhCLEVBQUV5QixVQUNSQyxhQUFjMUIsRUFBRTJCLE1BQU1DLFFBRXhCL0IsRUFBS1oscUJBQXFCNEMsSUFBSWpDLEtBRWhDQyxFQUFLRixXQUNKbUMsS0FBSyxXQUNOakMsRUFBS1YsZUFBZTRDLE9BQ3BCbEMsRUFBS0YsZUF6QkxmLE1BQUtZLGVBMkJOLEtBRUhBLFlBQWEsV0FDWFosS0FBS0MsT0FBTzRCLElBQUksSUFDaEI3QixLQUFLSyxxQkFBcUIwQixRQUMxQi9CLEtBQUtJLFlBQVljLEtBQUssS0FHeEJKLGdCQUFpQixXQUNmZCxLQUFLUyxtQkFBbUIwQyxPQUN4Qm5ELEtBQUtZLGlCQVlMUyxFQUFpQjVCLFNBQVNDLEtBQUtDLFFBQy9CeUQsUUFBUyxLQUVUdkQsUUFDRXdELE1BQVMsVUFHWEMsU0FBVTdCLEVBQUU2QixTQUFTbEUsRUFBWW1FLDBCQUVqQ3hDLE9BQVEsV0FFTixNQURBZixNQUFLRSxJQUFJZ0IsS0FBS2xCLEtBQUtzRCxTQUFTdEQsS0FBS3NCLE1BQU1rQyxhQUNoQ3hELE1BR1R5RCxPQUFRLFdBQ04sR0FBSTdCLEdBQVE1QixLQUFLc0IsTUFBTW9DLElBQUksT0FFM0IxQixHQUFFQyxLQUFLLDBEQUNMQyxPQUFRLE9BQ1JDLE1BQ0VQLE1BQU9BLEVBQ1ArQixhQUFjLEdBRWhCdEIsUUFBU3RELElBQ1J1RCxLQUFLLFNBQVNDLEdBQ2YsR0FBSXFCLEdBQU9yQixFQUFLc0IsTUFBTSxHQUNsQjdDLEVBQVcsR0FBSTlCLEdBQVN5RCxVQUMxQkMsS0FBTWdCLEVBQUtmLFVBQ1hpQixTQUFVQyxLQUFLQyxNQUFNSixFQUFLSyxhQUMxQkMsSUFBS0gsS0FBS0MsTUFBTUosRUFBS08sY0FDckJyQixhQUFjYyxFQUFLYixNQUFNQyxPQUczQmxFLEdBQWVtRSxJQUFJakMsR0FDbkJsQyxFQUFlc0YscUJBQ2Z4RixFQUFXeUYsUUFBUSxrQkFDbEJuQixLQUFLLFdBQ050RSxFQUFXeUYsUUFBUSx3QkFZdkJDLEVBQWU3RSxTQUFTQyxLQUFLQyxRQUMvQkMsR0FBSSxnQkFFSkcsV0FBWSxXQUNWQyxLQUFLdUUsU0FBU3pGLEVBQWdCLE1BQU9rQixLQUFLZSxTQUc1Q0EsT0FBUSxTQUFTQyxHQUNmLEdBQUl3RCxHQUFtQixHQUFJQyxJQUFtQm5ELE1BQU9OLEdBQ3JEaEIsTUFBS0UsSUFBSXFCLE9BQU9pRCxFQUFpQnpELFNBQVNuQixPQVcxQzZFLEVBQW1CaEYsU0FBU0MsS0FBS0MsUUFDbkN5RCxRQUFTLEtBRVRFLFNBQVU3QixFQUFFNkIsU0FBU2xFLEVBQVlzRixjQUVqQzdFLFFBQ0U4RSwyQkFBNEIsa0JBRzlCNUQsT0FBUSxXQUVOLE1BREFmLE1BQUtFLElBQUlnQixLQUFLbEIsS0FBS3NELFNBQVN0RCxLQUFLc0IsTUFBTWtDLGFBQ2hDeEQsTUFHVDRFLGVBQWdCLFdBQ2Q5RixFQUFlK0YsT0FBTzdFLEtBQUtzQixPQUMzQnRCLEtBQUtFLElBQUkyRSxTQUNUL0YsRUFBZXNGLHdCQVlmVSxFQUFNckYsU0FBU0MsS0FBS0MsUUFDdEJDLEdBQUksa0JBRUpHLFdBQVksV0FDVkMsS0FBSytFLGdCQUFrQi9FLEtBQUtFLElBQUlDLEtBQUssbUJBQ3JDSCxLQUFLZ0YsV0FBYWhGLEtBQUtFLElBQUlDLEtBQUssY0FDaENILEtBQUtpRixjQUFnQixFQUNyQmpGLEtBQUtrRixTQUFXLEVBRWhCcEcsRUFBaUIsR0FBSVEsR0FBYzZGLGVBRW5DdkcsRUFBYSxHQUFJWSxHQUNqQlgsRUFBZSxHQUFJeUYsR0FFbkJ0RSxLQUFLdUUsU0FBU3pGLEVBQWdCLE1BQU9rQixLQUFLb0YsVUFDMUNwRixLQUFLdUUsU0FBU3pGLEVBQWdCLFNBQVVrQixLQUFLcUYsY0FFN0MsSUFBSUMsR0FBY0MsYUFBYUMsUUFBUSx3QkFDbkNGLElBQ0Z0RixLQUFLeUYsVUFBVUgsR0FHakJ0RixLQUFLZSxVQUdQQSxPQUFRLFdBQ05mLEtBQUsrRSxnQkFBZ0I3RCxLQUFLbEIsS0FBS2lGLGNBQWdCLFFBQy9DakYsS0FBS2dGLFdBQVc5RCxLQUFLbEIsS0FBS2tGLFNBQVcsT0FHdkNFLFNBQVUsU0FBU3BFLEdBQ2pCaEIsS0FBS2lGLGVBQWlCakUsRUFBUzBDLElBQUksWUFDbkMxRCxLQUFLK0UsZ0JBQWdCN0QsS0FBS2xCLEtBQUtpRixjQUFnQixRQUMvQ2pGLEtBQUtrRixVQUFZbEUsRUFBUzBDLElBQUksT0FDOUIxRCxLQUFLZ0YsV0FBVzlELEtBQUtsQixLQUFLa0YsU0FBVyxPQUd2Q0csY0FBZSxTQUFTckUsR0FDdEJoQixLQUFLaUYsZUFBaUJqRSxFQUFTMEMsSUFBSSxZQUNuQzFELEtBQUsrRSxnQkFBZ0I3RCxLQUFLbEIsS0FBS2lGLGNBQWdCLFFBQy9DakYsS0FBS2tGLFVBQVlsRSxFQUFTMEMsSUFBSSxPQUM5QjFELEtBQUtnRixXQUFXOUQsS0FBS2xCLEtBQUtrRixTQUFXLE9BR3ZDTyxVQUFXLFNBQVNDLEdBQ2xCLEdBQ0kxRSxHQURBd0IsRUFBWW1ELEtBQUtDLE1BQU1GLEVBRTNCakUsR0FBRWlCLFFBQVFGLEVBQVcsU0FBU3FELEdBQzVCN0UsRUFBVyxHQUFJOUIsR0FBU3lELFVBQ3RCQyxLQUFNaUQsRUFBR2pELEtBQ1RrQixTQUFVK0IsRUFBRy9CLFNBQ2JJLElBQUsyQixFQUFHM0IsSUFDUnBCLGFBQWMrQyxFQUFHL0MsZUFFbkJoRSxFQUFlbUUsSUFBSWpDLFFBVXJCOEUsRUFBTyxXQUNHLEdBQUloQixHQUdsQixRQUNFZ0IsS0FBTUEsTUFJVnBILGNBQWNDLE1BQU1tSCIsImZpbGUiOiJ2aWV3cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICAqIEhlYWx0aCBUcmFja2VyIG5hbWVzcGFjZS5cbiAgKiBAbmFtZXNwYWNlIEhlYWx0aFRyYWNrZXJcbiAgKi9cbnZhciBIZWFsdGhUcmFja2VyID0gSGVhbHRoVHJhY2tlciB8fCB7fTtcblxuLyoqXG4gICogRW5jYXBzdWx0ZXMgYWxsIHZpZXdzLlxuICAqIEBuYW1lc3BhY2UgSGVhbHRoVHJhY2tlci5WaWV3c1xuICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBudXRyaXRpb25peEhlYWRlciBIb2xkcyBBUEkgSUQgYW5kIEtFWSBmb3IgYWNjZXNzIHRvXG4gICogICBOdXRyaXRpb254IEFQSS5cbiAgKiBAcHJvcGVydHkge29iamVjdH0gSFRNb2RlbHMgYWxpYXMgZm9yIEhlYWx0aFRyYWNrZXIuTW9kZWxzIG5hbWVzcGFjZS5cbiAgKiBAcHJvcGVydHkge29iamVjdH0gSFRUZW1wbGF0ZXMgYWxpYXMgZm9yIEhlYWx0aFRyYWNrZXIuVGVtcGxhdGVzIG5hbWVzcGFjZS5cbiAgKi9cbkhlYWx0aFRyYWNrZXIuVmlld3MgPSAoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgbnV0cml0aW9uaXhIZWFkZXIgPSB7XG4gICAgXCJ4LWFwcC1pZFwiOiAnZmZmOTczMWInLFxuICAgIFwieC1hcHAta2V5XCI6ICdhOWM1NTBhNmE0NzVjNTYyYWRmM2VjZmE0NGVjNzQ4YSdcbiAgfTtcbiAgdmFyIEhUTW9kZWxzID0gSGVhbHRoVHJhY2tlci5Nb2RlbHM7XG4gIHZhciBIVFRlbXBsYXRlcyA9IEhlYWx0aFRyYWNrZXIuVGVtcGxhdGVzO1xuICB2YXIgSFRDb2xsZWN0aW9ucyA9IEhlYWx0aFRyYWNrZXIuQ29sbGVjdGlvbnM7XG5cbiAgdmFyIHNlYXJjaFZpZXc7XG4gIHZhciBmb29kTGlzdFZpZXc7XG4gIHZhciBmb29kQ29sbGVjdGlvbjtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyB0aGUgZm9vZCBzZWFyY2ggdmlldy5cbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBtZW1iZXJvZiBIZWFsdGhUcmFja2VyLlZpZXdzflxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgc2VhcmNoVmlldyA9IG5ldyBTZWFyY2hWaWV3KCk7XG4gICAqL1xuICB2YXIgU2VhcmNoVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICBlbDogJy5qcy1mb29kLXNlYXJjaCcsXG5cbiAgICBldmVudHM6IHtcbiAgICAgICdrZXlkb3duIC5zZWFyY2gnOiAnc2VhcmNoRm9vZHMnLFxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc2VhcmNoID0gdGhpcy4kZWwuZmluZCgnLnNlYXJjaCcpO1xuICAgICAgdGhpcy5mb29kQ2hvaWNlcyA9IHRoaXMuJGVsLmZpbmQoJy5mb29kLWNob2ljZXMnKTtcbiAgICAgIHRoaXMuc2VhcmNoRm9vZENvbGxlY3Rpb24gPSBuZXcgSFRDb2xsZWN0aW9ucy5TZWFyY2hGb29kQ29sbGVjdGlvbigpO1xuICAgICAgdGhpcy5zZWFyY2hFcnJvck1zZyA9IHRoaXMuJGVsLmZpbmQoJy5qcy1zZWFyY2gtZXJyb3InKS5oaWRlKCk7XG4gICAgICB0aGlzLml0ZW1TZWFyY2hFcnJvck1zZyA9IHRoaXMuJGVsLmZpbmQoJy5qcy1pdGVtLXNlYXJjaC1lcnJvcicpLmhpZGUoKTtcblxuICAgICAgdGhpcy5vbih7XG4gICAgICAgICdmb29kc2VsZWN0ZWQnOiB0aGlzLmNsZWFyU2VhcmNoLFxuICAgICAgICAnaXRlbXNlYXJjaGVycm9yJzogdGhpcy5pdGVtU2VhcmNoRXJyb3JcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGZvb2RJdGVtO1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgc2VsZi5mb29kQ2hvaWNlcy5odG1sKCcnKTtcbiAgICAgIHRoaXMuc2VhcmNoRm9vZENvbGxlY3Rpb24uZWFjaChmdW5jdGlvbihmKSB7XG4gICAgICAgIGZvb2RJdGVtID0gbmV3IFNlYXJjaEl0ZW1WaWV3KHsgbW9kZWw6IGYgfSk7XG4gICAgICAgIHNlbGYuZm9vZENob2ljZXMuYXBwZW5kKGZvb2RJdGVtLnJlbmRlcigpLmVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzZWFyY2hGb29kczogXy5kZWJvdW5jZShmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgcXVlcnkgPSB0aGlzLnNlYXJjaC52YWwoKS50cmltKCk7XG5cbiAgICAgIHNlbGYuc2VhcmNoRm9vZENvbGxlY3Rpb24ucmVzZXQoKTtcblxuICAgICAgaWYgKCFxdWVyeSkge1xuICAgICAgICB0aGlzLmNsZWFyU2VhcmNoKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgJC5hamF4KCdodHRwczovL3RyYWNrYXBpLm51dHJpdGlvbml4LmNvbS92Mi9zZWFyY2gvaW5zdGFudCcsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcbiAgICAgICAgICBzZWxmOiBmYWxzZSxcbiAgICAgICAgICBicmFuZGVkOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBoZWFkZXJzOiBudXRyaXRpb25peEhlYWRlclxuICAgICAgfSkuZG9uZShmdW5jdGlvbihyZXNwKSB7XG4gICAgICAgIHZhciBmb29kSXRlbTtcbiAgICAgICAgdmFyIGZvb2RJdGVtcyA9IHJlc3AuY29tbW9uO1xuICAgICAgICBfLmZvckVhY2goZm9vZEl0ZW1zLCBmdW5jdGlvbihmKSB7XG4gICAgICAgICAgZm9vZEl0ZW0gPSBuZXcgSFRNb2RlbHMuRm9vZEl0ZW0oe1xuICAgICAgICAgICAgbmFtZTogZi5mb29kX25hbWUsXG4gICAgICAgICAgICB0aHVtYm5haWxVUkw6IGYucGhvdG8udGh1bWJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzZWxmLnNlYXJjaEZvb2RDb2xsZWN0aW9uLmFkZChmb29kSXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgfSkuZmFpbChmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5zZWFyY2hFcnJvck1zZy5zaG93KCk7XG4gICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICB9LCA0MDApLFxuXG4gICAgY2xlYXJTZWFyY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZWFyY2gudmFsKCcnKTtcbiAgICAgIHRoaXMuc2VhcmNoRm9vZENvbGxlY3Rpb24ucmVzZXQoKTtcbiAgICAgIHRoaXMuZm9vZENob2ljZXMuaHRtbCgnJyk7XG4gICAgfSxcblxuICAgIGl0ZW1TZWFyY2hFcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLml0ZW1TZWFyY2hFcnJvck1zZy5zaG93KCk7XG4gICAgICB0aGlzLmNsZWFyU2VhcmNoKCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyB0aGUgZm9vZCBzZWFyY2ggZHJvcGRvd24gb3B0aW9uIHZpZXcuXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAbWVtYmVyb2YgSGVhbHRoVHJhY2tlci5WaWV3c35cbiAgICogQHBhcmFtIHtvYmplY3R9IG1vZGVsIC0gVGhlIEZvb2RJdGVtIE1vZGVsLlxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgc2VhcmNoSXRlbVZpZXcgPSBuZXcgU2VhcmNoSXRlbVZpZXcoeyBtb2RlbDogbmV3IEZvb2RJdGVtKCkgfSk7XG4gICAqL1xuICB2YXIgU2VhcmNoSXRlbVZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgICB0YWdOYW1lOiAnbGknLFxuXG4gICAgICBldmVudHM6IHtcbiAgICAgICAgJ2NsaWNrJzogJ3NlbGVjdCdcbiAgICAgIH0sXG5cbiAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKEhUVGVtcGxhdGVzLmZvb2RTZWFyY2hEcm9wRG93bk9wdGlvbiksXG5cbiAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMpKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuXG4gICAgICBzZWxlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLm1vZGVsLmdldCgnbmFtZScpO1xuXG4gICAgICAgICQuYWpheCgnaHR0cHM6Ly90cmFja2FwaS5udXRyaXRpb25peC5jb20vdjIvbmF0dXJhbC9udXRyaWVudHMvJywge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcbiAgICAgICAgICAgIG51bV9zZXJ2aW5nczogMSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcnM6IG51dHJpdGlvbml4SGVhZGVyXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICAgIHZhciBmb29kID0gcmVzcC5mb29kc1swXTtcbiAgICAgICAgICB2YXIgZm9vZEl0ZW0gPSBuZXcgSFRNb2RlbHMuRm9vZEl0ZW0oe1xuICAgICAgICAgICAgbmFtZTogZm9vZC5mb29kX25hbWUsXG4gICAgICAgICAgICBjYWxvcmllczogTWF0aC5yb3VuZChmb29kLm5mX2NhbG9yaWVzKSxcbiAgICAgICAgICAgIGZhdDogTWF0aC5yb3VuZChmb29kLm5mX3RvdGFsX2ZhdCksXG4gICAgICAgICAgICB0aHVtYm5haWxVUkw6IGZvb2QucGhvdG8udGh1bWJcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGZvb2RDb2xsZWN0aW9uLmFkZChmb29kSXRlbSk7XG4gICAgICAgICAgZm9vZENvbGxlY3Rpb24uc2F2ZVRvTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgc2VhcmNoVmlldy50cmlnZ2VyKCdmb29kc2VsZWN0ZWQnKTtcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZWFyY2hWaWV3LnRyaWdnZXIoJ2l0ZW1zZWFyY2hlcnJvcicpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgdGhlIGZvb2QgbGlzdCB2aWV3LlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3N+XG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBmb29kTGlzdFZpZXcgPSBuZXcgRm9vZExpc3RWaWV3KCk7XG4gICAqL1xuICB2YXIgRm9vZExpc3RWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGVsOiAnLmpzLWZvb2QtbGlzdCcsXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8oZm9vZENvbGxlY3Rpb24sICdhZGQnLCB0aGlzLnJlbmRlcik7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24oZm9vZEl0ZW0pIHtcbiAgICAgIHZhciBmb29kTGlzdEl0ZW1WaWV3ID0gbmV3IEZvb2RMaXN0SXRlbVZpZXcoeyBtb2RlbDogZm9vZEl0ZW0gfSk7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQoZm9vZExpc3RJdGVtVmlldy5yZW5kZXIoKS5lbCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyB0aGUgZm9vZCBsaXN0IGl0ZW0gdmlldy5cbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBtZW1iZXJvZiBIZWFsdGhUcmFja2VyLlZpZXdzflxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgZm9vZExpc3RJdGVtVmlldyA9IG5ldyBGb29kTGlzdEl0ZW1WaWV3KCk7XG4gICAqL1xuICB2YXIgRm9vZExpc3RJdGVtVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICB0YWdOYW1lOiAnbGknLFxuXG4gICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoSFRUZW1wbGF0ZXMuZm9vZExpc3RJdGVtKSxcblxuICAgIGV2ZW50czoge1xuICAgICAgJ2NsaWNrIC5mb29kLWxpc3RfX3JlbW92ZSc6ICdyZW1vdmVGb29kSXRlbSdcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZW1vdmVGb29kSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICBmb29kQ29sbGVjdGlvbi5yZW1vdmUodGhpcy5tb2RlbCk7XG4gICAgICB0aGlzLiRlbC5yZW1vdmUoKTtcbiAgICAgIGZvb2RDb2xsZWN0aW9uLnNhdmVUb0xvY2FsU3RvcmFnZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgdGhlIEhlYWx0aCBUcmFja2VyIGFwcCB2aWV3LlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3NcbiAgICogQHByb3BlcnR5IHtvYmplY3R9IGVsIFZpZXcgZWxlbWVudC5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIGFwcCA9IG5ldyBBcHAoKTtcbiAgICovXG4gIHZhciBBcHAgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgZWw6ICcjaGVhbHRoLXRyYWNrZXInLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnRvdGFsQ2Fsb3JpZXNFbCA9IHRoaXMuJGVsLmZpbmQoJy50b3RhbC1jYWxvcmllcycpO1xuICAgICAgdGhpcy50b3RhbEZhdEVsID0gdGhpcy4kZWwuZmluZCgnLnRvdGFsLWZhdCcpO1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzID0gMDtcbiAgICAgIHRoaXMudG90YWxGYXQgPSAwO1xuXG4gICAgICBmb29kQ29sbGVjdGlvbiA9IG5ldyBIVENvbGxlY3Rpb25zLkZvb2RDb2xsZWN0aW9uKCk7XG5cbiAgICAgIHNlYXJjaFZpZXcgPSBuZXcgU2VhcmNoVmlldygpO1xuICAgICAgZm9vZExpc3RWaWV3ID0gbmV3IEZvb2RMaXN0VmlldygpO1xuXG4gICAgICB0aGlzLmxpc3RlblRvKGZvb2RDb2xsZWN0aW9uLCAnYWRkJywgdGhpcy5hZGRTdGF0cyk7XG4gICAgICB0aGlzLmxpc3RlblRvKGZvb2RDb2xsZWN0aW9uLCAncmVtb3ZlJywgdGhpcy5zdWJ0cmFjdFN0YXRzKTtcblxuICAgICAgdmFyIHN0b3JlZFN0YXRlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hlYWx0aFRyYWNrZXJGb29kTGlzdCcpO1xuICAgICAgaWYgKHN0b3JlZFN0YXRlKSB7XG4gICAgICAgIHRoaXMubG9hZFN0YXRlKHN0b3JlZFN0YXRlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudG90YWxDYWxvcmllc0VsLmh0bWwodGhpcy50b3RhbENhbG9yaWVzICsgJyBjYWwnKTtcbiAgICAgIHRoaXMudG90YWxGYXRFbC5odG1sKHRoaXMudG90YWxGYXQgKyAnIGcnKTtcbiAgICB9LFxuXG4gICAgYWRkU3RhdHM6IGZ1bmN0aW9uKGZvb2RJdGVtKSB7XG4gICAgICB0aGlzLnRvdGFsQ2Fsb3JpZXMgKz0gZm9vZEl0ZW0uZ2V0KCdjYWxvcmllcycpO1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzRWwuaHRtbCh0aGlzLnRvdGFsQ2Fsb3JpZXMgKyAnIGNhbCcpO1xuICAgICAgdGhpcy50b3RhbEZhdCArPSBmb29kSXRlbS5nZXQoJ2ZhdCcpO1xuICAgICAgdGhpcy50b3RhbEZhdEVsLmh0bWwodGhpcy50b3RhbEZhdCArICcgZycpO1xuICAgIH0sXG5cbiAgICBzdWJ0cmFjdFN0YXRzOiBmdW5jdGlvbihmb29kSXRlbSkge1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzIC09IGZvb2RJdGVtLmdldCgnY2Fsb3JpZXMnKTtcbiAgICAgIHRoaXMudG90YWxDYWxvcmllc0VsLmh0bWwodGhpcy50b3RhbENhbG9yaWVzICsgJyBjYWwnKTtcbiAgICAgIHRoaXMudG90YWxGYXQgLT0gZm9vZEl0ZW0uZ2V0KCdmYXQnKTtcbiAgICAgIHRoaXMudG90YWxGYXRFbC5odG1sKHRoaXMudG90YWxGYXQgKyAnIGcnKTtcbiAgICB9LFxuXG4gICAgbG9hZFN0YXRlOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgdmFyIGZvb2RJdGVtcyA9IEpTT04ucGFyc2Uoc3RhdGUpO1xuICAgICAgdmFyIGZvb2RJdGVtO1xuICAgICAgXy5mb3JFYWNoKGZvb2RJdGVtcywgZnVuY3Rpb24oZmkpIHtcbiAgICAgICAgZm9vZEl0ZW0gPSBuZXcgSFRNb2RlbHMuRm9vZEl0ZW0oe1xuICAgICAgICAgIG5hbWU6IGZpLm5hbWUsXG4gICAgICAgICAgY2Fsb3JpZXM6IGZpLmNhbG9yaWVzLFxuICAgICAgICAgIGZhdDogZmkuZmF0LFxuICAgICAgICAgIHRodW1ibmFpbFVSTDogZmkudGh1bWJuYWlsVVJMXG4gICAgICAgIH0pO1xuICAgICAgICBmb29kQ29sbGVjdGlvbi5hZGQoZm9vZEl0ZW0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIEhlYWx0aCBUcmFja2VyIGFwcGxpY2F0aW9uLlxuICAgKiBAZnVuY3Rpb25cbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3N+XG4gICAqL1xuICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFwcCA9IG5ldyBBcHAoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0pKCk7XG5cbkhlYWx0aFRyYWNrZXIuVmlld3MuaW5pdCgpO1xuIl19
