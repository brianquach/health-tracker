var HealthTracker=HealthTracker||{};HealthTracker.Views=function(){"use strict";var t,e,a,o={"x-app-id":"fff9731b","x-app-key":"a9c550a6a475c562adf3ecfa44ec748a"},i=HealthTracker.Models,r=HealthTracker.Templates,s=HealthTracker.Collections,n=Backbone.View.extend({el:".js-food-search",events:{"keydown .search":"searchFoods"},initialize:function(){this.search=this.$el.find(".search"),this.foodChoices=this.$el.find(".food-choices"),this.searchFoodCollection=new s.SearchFoodCollection,this.searchErrorMsg=this.$el.find(".js-search-error").hide(),this.itemSearchErrorMsg=this.$el.find(".js-item-search-error").hide(),this.loading=this.$el.find(".js-loading").hide(),this.on({foodselected:this.clearSearch,itemsearcherror:this.itemSearchError,itemStartloading:this.itemStartLoading,itemStoploading:this.itemStopLoading})},render:function(){var t,e=this;e.foodChoices.html(""),this.searchFoodCollection.each(function(a){t=new l({model:a}),e.foodChoices.append(t.render().el)})},searchFoods:_.debounce(function(t){var e=this,a=this.search.val().trim();return this.searchFoodCollection.reset(),a?(this.loading.show(),void $.ajax("https://trackapi.nutritionix.com/v2/search/instant",{method:"GET",data:{query:a,self:!1,branded:!1},headers:o}).done(function(t){var a,o=t.common;_.forEach(o,function(t){a=new i.FoodItem({name:t.food_name,thumbnailURL:t.photo.thumb}),e.searchFoodCollection.add(a)}),e.render()}).fail(function(){e.searchErrorMsg.show(),e.render()}).always(function(){e.loading.hide()})):void this.clearSearch()},400),clearSearch:function(){this.search.val(""),this.searchFoodCollection.reset(),this.foodChoices.html("")},itemSearchError:function(){this.itemSearchErrorMsg.show(),this.clearSearch()},itemStartLoading:function(){this.loading.show()},itemStopLoading:function(){this.loading.hide()}}),l=Backbone.View.extend({tagName:"li",events:{click:"select"},template:_.template(r.foodSearchDropDownOption),render:function(){return this.$el.html(this.template(this.model.attributes)),this},select:function(){var e=this.model.get("name");t.trigger("itemStartloading"),$.ajax("https://trackapi.nutritionix.com/v2/natural/nutrients/",{method:"POST",data:{query:e,num_servings:1},headers:o}).done(function(e){var o=e.foods[0],r=new i.FoodItem({name:o.food_name,calories:Math.round(o.nf_calories),fat:Math.round(o.nf_total_fat),thumbnailURL:o.photo.thumb});a.add(r),a.saveToLocalStorage(),t.trigger("foodselected")}).fail(function(){t.trigger("itemsearcherror")}).always(function(){t.trigger("itemStoploading")})}}),h=Backbone.View.extend({el:".js-food-list",initialize:function(){this.listenTo(a,"add",this.render)},render:function(t){var e=new c({model:t});this.$el.append(e.render().el)}}),c=Backbone.View.extend({tagName:"li",template:_.template(r.foodListItem),events:{"click .food-list__remove":"removeFoodItem"},render:function(){return this.$el.html(this.template(this.model.attributes)),this},removeFoodItem:function(){a.remove(this.model),this.$el.remove(),a.saveToLocalStorage()}}),d=Backbone.View.extend({el:"#health-tracker",initialize:function(){this.totalCaloriesEl=this.$el.find(".total-calories"),this.totalFatEl=this.$el.find(".total-fat"),this.totalCalories=0,this.totalFat=0,a=new s.FoodCollection,t=new n,e=new h,this.listenTo(a,"add",this.addStats),this.listenTo(a,"remove",this.subtractStats);var o=localStorage.getItem("healthTrackerFoodList");o&&this.loadState(o),this.render()},render:function(){this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFatEl.html(this.totalFat+" g")},addStats:function(t){this.totalCalories+=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat+=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},subtractStats:function(t){this.totalCalories-=t.get("calories"),this.totalCaloriesEl.html(this.totalCalories+" cal"),this.totalFat-=t.get("fat"),this.totalFatEl.html(this.totalFat+" g")},loadState:function(t){var e,o=JSON.parse(t);_.forEach(o,function(t){e=new i.FoodItem({name:t.name,calories:t.calories,fat:t.fat,thumbnailURL:t.thumbnailURL}),a.add(e)})}}),m=function(){new d};return{init:m}}(),HealthTracker.Views.init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZXdzLmpzIl0sIm5hbWVzIjpbIkhlYWx0aFRyYWNrZXIiLCJWaWV3cyIsInNlYXJjaFZpZXciLCJmb29kTGlzdFZpZXciLCJmb29kQ29sbGVjdGlvbiIsIm51dHJpdGlvbml4SGVhZGVyIiwieC1hcHAtaWQiLCJ4LWFwcC1rZXkiLCJIVE1vZGVscyIsIk1vZGVscyIsIkhUVGVtcGxhdGVzIiwiVGVtcGxhdGVzIiwiSFRDb2xsZWN0aW9ucyIsIkNvbGxlY3Rpb25zIiwiU2VhcmNoVmlldyIsIkJhY2tib25lIiwiVmlldyIsImV4dGVuZCIsImVsIiwiZXZlbnRzIiwia2V5ZG93biAuc2VhcmNoIiwiaW5pdGlhbGl6ZSIsInRoaXMiLCJzZWFyY2giLCIkZWwiLCJmaW5kIiwiZm9vZENob2ljZXMiLCJzZWFyY2hGb29kQ29sbGVjdGlvbiIsIlNlYXJjaEZvb2RDb2xsZWN0aW9uIiwic2VhcmNoRXJyb3JNc2ciLCJoaWRlIiwiaXRlbVNlYXJjaEVycm9yTXNnIiwibG9hZGluZyIsIm9uIiwiZm9vZHNlbGVjdGVkIiwiY2xlYXJTZWFyY2giLCJpdGVtc2VhcmNoZXJyb3IiLCJpdGVtU2VhcmNoRXJyb3IiLCJpdGVtU3RhcnRsb2FkaW5nIiwiaXRlbVN0YXJ0TG9hZGluZyIsIml0ZW1TdG9wbG9hZGluZyIsIml0ZW1TdG9wTG9hZGluZyIsInJlbmRlciIsImZvb2RJdGVtIiwic2VsZiIsImh0bWwiLCJlYWNoIiwiZiIsIlNlYXJjaEl0ZW1WaWV3IiwibW9kZWwiLCJhcHBlbmQiLCJzZWFyY2hGb29kcyIsIl8iLCJkZWJvdW5jZSIsImUiLCJxdWVyeSIsInZhbCIsInRyaW0iLCJyZXNldCIsInNob3ciLCIkIiwiYWpheCIsIm1ldGhvZCIsImRhdGEiLCJicmFuZGVkIiwiaGVhZGVycyIsImRvbmUiLCJyZXNwIiwiZm9vZEl0ZW1zIiwiY29tbW9uIiwiZm9yRWFjaCIsIkZvb2RJdGVtIiwibmFtZSIsImZvb2RfbmFtZSIsInRodW1ibmFpbFVSTCIsInBob3RvIiwidGh1bWIiLCJhZGQiLCJmYWlsIiwiYWx3YXlzIiwidGFnTmFtZSIsImNsaWNrIiwidGVtcGxhdGUiLCJmb29kU2VhcmNoRHJvcERvd25PcHRpb24iLCJhdHRyaWJ1dGVzIiwic2VsZWN0IiwiZ2V0IiwidHJpZ2dlciIsIm51bV9zZXJ2aW5ncyIsImZvb2QiLCJmb29kcyIsImNhbG9yaWVzIiwiTWF0aCIsInJvdW5kIiwibmZfY2Fsb3JpZXMiLCJmYXQiLCJuZl90b3RhbF9mYXQiLCJzYXZlVG9Mb2NhbFN0b3JhZ2UiLCJGb29kTGlzdFZpZXciLCJsaXN0ZW5UbyIsImZvb2RMaXN0SXRlbVZpZXciLCJGb29kTGlzdEl0ZW1WaWV3IiwiZm9vZExpc3RJdGVtIiwiY2xpY2sgLmZvb2QtbGlzdF9fcmVtb3ZlIiwicmVtb3ZlRm9vZEl0ZW0iLCJyZW1vdmUiLCJBcHAiLCJ0b3RhbENhbG9yaWVzRWwiLCJ0b3RhbEZhdEVsIiwidG90YWxDYWxvcmllcyIsInRvdGFsRmF0IiwiRm9vZENvbGxlY3Rpb24iLCJhZGRTdGF0cyIsInN1YnRyYWN0U3RhdHMiLCJzdG9yZWRTdGF0ZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJsb2FkU3RhdGUiLCJzdGF0ZSIsIkpTT04iLCJwYXJzZSIsImZpIiwiaW5pdCJdLCJtYXBwaW5ncyI6IkFBSUEsR0FBSUEsZUFBZ0JBLGlCQVVwQkEsZUFBY0MsTUFBUSxXQUNwQixZQUVBLElBUUlDLEdBQ0FDLEVBQ0FDLEVBVkFDLEdBQ0ZDLFdBQVksV0FDWkMsWUFBYSxvQ0FFWEMsRUFBV1IsY0FBY1MsT0FDekJDLEVBQWNWLGNBQWNXLFVBQzVCQyxFQUFnQlosY0FBY2EsWUFhOUJDLEVBQWFDLFNBQVNDLEtBQUtDLFFBQzdCQyxHQUFJLGtCQUVKQyxRQUNFQyxrQkFBbUIsZUFHckJDLFdBQVksV0FDVkMsS0FBS0MsT0FBU0QsS0FBS0UsSUFBSUMsS0FBSyxXQUM1QkgsS0FBS0ksWUFBY0osS0FBS0UsSUFBSUMsS0FBSyxpQkFDakNILEtBQUtLLHFCQUF1QixHQUFJZixHQUFjZ0Is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QixLQUFLdUYsZUFBaUJsRSxFQUFTMkMsSUFBSSxZQUNuQ2hFLEtBQUtxRixnQkFBZ0I5RCxLQUFLdkIsS0FBS3VGLGNBQWdCLFFBQy9DdkYsS0FBS3dGLFVBQVluRSxFQUFTMkMsSUFBSSxPQUM5QmhFLEtBQUtzRixXQUFXL0QsS0FBS3ZCLEtBQUt3RixTQUFXLE9BR3ZDRyxjQUFlLFNBQVN0RSxHQUN0QnJCLEtBQUt1RixlQUFpQmxFLEVBQVMyQyxJQUFJLFlBQ25DaEUsS0FBS3FGLGdCQUFnQjlELEtBQUt2QixLQUFLdUYsY0FBZ0IsUUFDL0N2RixLQUFLd0YsVUFBWW5FLEVBQVMyQyxJQUFJLE9BQzlCaEUsS0FBS3NGLFdBQVcvRCxLQUFLdkIsS0FBS3dGLFNBQVcsT0FHdkNPLFVBQVcsU0FBU0MsR0FDbEIsR0FDSTNFLEdBREF5QixFQUFZbUQsS0FBS0MsTUFBTUYsRUFFM0JsRSxHQUFFa0IsUUFBUUYsRUFBVyxTQUFTcUQsR0FDNUI5RSxFQUFXLEdBQUluQyxHQUFTK0QsVUFDdEJDLEtBQU1pRCxFQUFHakQsS0FDVG1CLFNBQVU4QixFQUFHOUIsU0FDYkksSUFBSzBCLEVBQUcxQixJQUNSckIsYUFBYytDLEVBQUcvQyxlQUVuQnRFLEVBQWV5RSxJQUFJbEMsUUFVckIrRSxFQUFPLFdBQ0csR0FBSWhCLEdBR2xCLFFBQ0VnQixLQUFNQSxNQUlWMUgsY0FBY0MsTUFBTXlIIiwiZmlsZSI6InZpZXdzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gICogSGVhbHRoIFRyYWNrZXIgbmFtZXNwYWNlLlxuICAqIEBuYW1lc3BhY2UgSGVhbHRoVHJhY2tlclxuICAqL1xudmFyIEhlYWx0aFRyYWNrZXIgPSBIZWFsdGhUcmFja2VyIHx8IHt9O1xuXG4vKipcbiAgKiBFbmNhcHN1bHRlcyBhbGwgdmlld3MuXG4gICogQG5hbWVzcGFjZSBIZWFsdGhUcmFja2VyLlZpZXdzXG4gICogQHByb3BlcnR5IHtvYmplY3R9IG51dHJpdGlvbml4SGVhZGVyIEhvbGRzIEFQSSBJRCBhbmQgS0VZIGZvciBhY2Nlc3MgdG9cbiAgKiAgIE51dHJpdGlvbnggQVBJLlxuICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBIVE1vZGVscyBhbGlhcyBmb3IgSGVhbHRoVHJhY2tlci5Nb2RlbHMgbmFtZXNwYWNlLlxuICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBIVFRlbXBsYXRlcyBhbGlhcyBmb3IgSGVhbHRoVHJhY2tlci5UZW1wbGF0ZXMgbmFtZXNwYWNlLlxuICAqL1xuSGVhbHRoVHJhY2tlci5WaWV3cyA9IChmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBudXRyaXRpb25peEhlYWRlciA9IHtcbiAgICBcIngtYXBwLWlkXCI6ICdmZmY5NzMxYicsXG4gICAgXCJ4LWFwcC1rZXlcIjogJ2E5YzU1MGE2YTQ3NWM1NjJhZGYzZWNmYTQ0ZWM3NDhhJ1xuICB9O1xuICB2YXIgSFRNb2RlbHMgPSBIZWFsdGhUcmFja2VyLk1vZGVscztcbiAgdmFyIEhUVGVtcGxhdGVzID0gSGVhbHRoVHJhY2tlci5UZW1wbGF0ZXM7XG4gIHZhciBIVENvbGxlY3Rpb25zID0gSGVhbHRoVHJhY2tlci5Db2xsZWN0aW9ucztcblxuICB2YXIgc2VhcmNoVmlldztcbiAgdmFyIGZvb2RMaXN0VmlldztcbiAgdmFyIGZvb2RDb2xsZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIHRoZSBmb29kIHNlYXJjaCB2aWV3LlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3N+XG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBzZWFyY2hWaWV3ID0gbmV3IFNlYXJjaFZpZXcoKTtcbiAgICovXG4gIHZhciBTZWFyY2hWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGVsOiAnLmpzLWZvb2Qtc2VhcmNoJyxcblxuICAgIGV2ZW50czoge1xuICAgICAgJ2tleWRvd24gLnNlYXJjaCc6ICdzZWFyY2hGb29kcycsXG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZWFyY2ggPSB0aGlzLiRlbC5maW5kKCcuc2VhcmNoJyk7XG4gICAgICB0aGlzLmZvb2RDaG9pY2VzID0gdGhpcy4kZWwuZmluZCgnLmZvb2QtY2hvaWNlcycpO1xuICAgICAgdGhpcy5zZWFyY2hGb29kQ29sbGVjdGlvbiA9IG5ldyBIVENvbGxlY3Rpb25zLlNlYXJjaEZvb2RDb2xsZWN0aW9uKCk7XG4gICAgICB0aGlzLnNlYXJjaEVycm9yTXNnID0gdGhpcy4kZWwuZmluZCgnLmpzLXNlYXJjaC1lcnJvcicpLmhpZGUoKTtcbiAgICAgIHRoaXMuaXRlbVNlYXJjaEVycm9yTXNnID0gdGhpcy4kZWwuZmluZCgnLmpzLWl0ZW0tc2VhcmNoLWVycm9yJykuaGlkZSgpO1xuICAgICAgdGhpcy5sb2FkaW5nID0gdGhpcy4kZWwuZmluZCgnLmpzLWxvYWRpbmcnKS5oaWRlKCk7XG5cbiAgICAgIHRoaXMub24oe1xuICAgICAgICAnZm9vZHNlbGVjdGVkJzogdGhpcy5jbGVhclNlYXJjaCxcbiAgICAgICAgJ2l0ZW1zZWFyY2hlcnJvcic6IHRoaXMuaXRlbVNlYXJjaEVycm9yLFxuICAgICAgICAnaXRlbVN0YXJ0bG9hZGluZyc6IHRoaXMuaXRlbVN0YXJ0TG9hZGluZyxcbiAgICAgICAgJ2l0ZW1TdG9wbG9hZGluZyc6IHRoaXMuaXRlbVN0b3BMb2FkaW5nLFxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZm9vZEl0ZW07XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBzZWxmLmZvb2RDaG9pY2VzLmh0bWwoJycpO1xuICAgICAgdGhpcy5zZWFyY2hGb29kQ29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uKGYpIHtcbiAgICAgICAgZm9vZEl0ZW0gPSBuZXcgU2VhcmNoSXRlbVZpZXcoeyBtb2RlbDogZiB9KTtcbiAgICAgICAgc2VsZi5mb29kQ2hvaWNlcy5hcHBlbmQoZm9vZEl0ZW0ucmVuZGVyKCkuZWwpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNlYXJjaEZvb2RzOiBfLmRlYm91bmNlKGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBxdWVyeSA9IHRoaXMuc2VhcmNoLnZhbCgpLnRyaW0oKTtcblxuICAgICAgdGhpcy5zZWFyY2hGb29kQ29sbGVjdGlvbi5yZXNldCgpO1xuXG4gICAgICBpZiAoIXF1ZXJ5KSB7XG4gICAgICAgIHRoaXMuY2xlYXJTZWFyY2goKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvYWRpbmcuc2hvdygpO1xuXG4gICAgICAkLmFqYXgoJ2h0dHBzOi8vdHJhY2thcGkubnV0cml0aW9uaXguY29tL3YyL3NlYXJjaC9pbnN0YW50Jywge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgIHNlbGY6IGZhbHNlLFxuICAgICAgICAgIGJyYW5kZWQ6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGhlYWRlcnM6IG51dHJpdGlvbml4SGVhZGVyXG4gICAgICB9KS5kb25lKGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgdmFyIGZvb2RJdGVtO1xuICAgICAgICB2YXIgZm9vZEl0ZW1zID0gcmVzcC5jb21tb247XG4gICAgICAgIF8uZm9yRWFjaChmb29kSXRlbXMsIGZ1bmN0aW9uKGYpIHtcbiAgICAgICAgICBmb29kSXRlbSA9IG5ldyBIVE1vZGVscy5Gb29kSXRlbSh7XG4gICAgICAgICAgICBuYW1lOiBmLmZvb2RfbmFtZSxcbiAgICAgICAgICAgIHRodW1ibmFpbFVSTDogZi5waG90by50aHVtYlxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNlbGYuc2VhcmNoRm9vZENvbGxlY3Rpb24uYWRkKGZvb2RJdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLnNlYXJjaEVycm9yTXNnLnNob3coKTtcbiAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5sb2FkaW5nLmhpZGUoKTtcbiAgICAgIH0pO1xuICAgIH0sIDQwMCksXG5cbiAgICBjbGVhclNlYXJjaDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNlYXJjaC52YWwoJycpO1xuICAgICAgdGhpcy5zZWFyY2hGb29kQ29sbGVjdGlvbi5yZXNldCgpO1xuICAgICAgdGhpcy5mb29kQ2hvaWNlcy5odG1sKCcnKTtcbiAgICB9LFxuXG4gICAgaXRlbVNlYXJjaEVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuaXRlbVNlYXJjaEVycm9yTXNnLnNob3coKTtcbiAgICAgIHRoaXMuY2xlYXJTZWFyY2goKTtcbiAgICB9LFxuXG4gICAgaXRlbVN0YXJ0TG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmxvYWRpbmcuc2hvdygpO1xuICAgIH0sXG5cbiAgICBpdGVtU3RvcExvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5sb2FkaW5nLmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIHRoZSBmb29kIHNlYXJjaCBkcm9wZG93biBvcHRpb24gdmlldy5cbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBtZW1iZXJvZiBIZWFsdGhUcmFja2VyLlZpZXdzflxuICAgKiBAcGFyYW0ge29iamVjdH0gbW9kZWwgLSBUaGUgRm9vZEl0ZW0gTW9kZWwuXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBzZWFyY2hJdGVtVmlldyA9IG5ldyBTZWFyY2hJdGVtVmlldyh7IG1vZGVsOiBuZXcgRm9vZEl0ZW0oKSB9KTtcbiAgICovXG4gIHZhciBTZWFyY2hJdGVtVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICAgIHRhZ05hbWU6ICdsaScsXG5cbiAgICAgIGV2ZW50czoge1xuICAgICAgICAnY2xpY2snOiAnc2VsZWN0J1xuICAgICAgfSxcblxuICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoSFRUZW1wbGF0ZXMuZm9vZFNlYXJjaERyb3BEb3duT3B0aW9uKSxcblxuICAgICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHRoaXMubW9kZWwuYXR0cmlidXRlcykpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG5cbiAgICAgIHNlbGVjdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBxdWVyeSA9IHRoaXMubW9kZWwuZ2V0KCduYW1lJyk7XG5cbiAgICAgICAgc2VhcmNoVmlldy50cmlnZ2VyKCdpdGVtU3RhcnRsb2FkaW5nJyk7XG5cbiAgICAgICAgJC5hamF4KCdodHRwczovL3RyYWNrYXBpLm51dHJpdGlvbml4LmNvbS92Mi9uYXR1cmFsL251dHJpZW50cy8nLCB7XG4gICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgbnVtX3NlcnZpbmdzOiAxLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhZGVyczogbnV0cml0aW9uaXhIZWFkZXJcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbihyZXNwKSB7XG4gICAgICAgICAgdmFyIGZvb2QgPSByZXNwLmZvb2RzWzBdO1xuICAgICAgICAgIHZhciBmb29kSXRlbSA9IG5ldyBIVE1vZGVscy5Gb29kSXRlbSh7XG4gICAgICAgICAgICBuYW1lOiBmb29kLmZvb2RfbmFtZSxcbiAgICAgICAgICAgIGNhbG9yaWVzOiBNYXRoLnJvdW5kKGZvb2QubmZfY2Fsb3JpZXMpLFxuICAgICAgICAgICAgZmF0OiBNYXRoLnJvdW5kKGZvb2QubmZfdG90YWxfZmF0KSxcbiAgICAgICAgICAgIHRodW1ibmFpbFVSTDogZm9vZC5waG90by50aHVtYlxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZm9vZENvbGxlY3Rpb24uYWRkKGZvb2RJdGVtKTtcbiAgICAgICAgICBmb29kQ29sbGVjdGlvbi5zYXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICBzZWFyY2hWaWV3LnRyaWdnZXIoJ2Zvb2RzZWxlY3RlZCcpO1xuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlYXJjaFZpZXcudHJpZ2dlcignaXRlbXNlYXJjaGVycm9yJyk7XG4gICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZWFyY2hWaWV3LnRyaWdnZXIoJ2l0ZW1TdG9wbG9hZGluZycpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgdGhlIGZvb2QgbGlzdCB2aWV3LlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3N+XG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBmb29kTGlzdFZpZXcgPSBuZXcgRm9vZExpc3RWaWV3KCk7XG4gICAqL1xuICB2YXIgRm9vZExpc3RWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGVsOiAnLmpzLWZvb2QtbGlzdCcsXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8oZm9vZENvbGxlY3Rpb24sICdhZGQnLCB0aGlzLnJlbmRlcik7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24oZm9vZEl0ZW0pIHtcbiAgICAgIHZhciBmb29kTGlzdEl0ZW1WaWV3ID0gbmV3IEZvb2RMaXN0SXRlbVZpZXcoeyBtb2RlbDogZm9vZEl0ZW0gfSk7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQoZm9vZExpc3RJdGVtVmlldy5yZW5kZXIoKS5lbCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyB0aGUgZm9vZCBsaXN0IGl0ZW0gdmlldy5cbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBtZW1iZXJvZiBIZWFsdGhUcmFja2VyLlZpZXdzflxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgZm9vZExpc3RJdGVtVmlldyA9IG5ldyBGb29kTGlzdEl0ZW1WaWV3KCk7XG4gICAqL1xuICB2YXIgRm9vZExpc3RJdGVtVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICB0YWdOYW1lOiAnbGknLFxuXG4gICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoSFRUZW1wbGF0ZXMuZm9vZExpc3RJdGVtKSxcblxuICAgIGV2ZW50czoge1xuICAgICAgJ2NsaWNrIC5mb29kLWxpc3RfX3JlbW92ZSc6ICdyZW1vdmVGb29kSXRlbSdcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh0aGlzLm1vZGVsLmF0dHJpYnV0ZXMpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZW1vdmVGb29kSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICBmb29kQ29sbGVjdGlvbi5yZW1vdmUodGhpcy5tb2RlbCk7XG4gICAgICB0aGlzLiRlbC5yZW1vdmUoKTtcbiAgICAgIGZvb2RDb2xsZWN0aW9uLnNhdmVUb0xvY2FsU3RvcmFnZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgdGhlIEhlYWx0aCBUcmFja2VyIGFwcCB2aWV3LlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3NcbiAgICogQHByb3BlcnR5IHtvYmplY3R9IGVsIFZpZXcgZWxlbWVudC5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIGFwcCA9IG5ldyBBcHAoKTtcbiAgICovXG4gIHZhciBBcHAgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgZWw6ICcjaGVhbHRoLXRyYWNrZXInLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnRvdGFsQ2Fsb3JpZXNFbCA9IHRoaXMuJGVsLmZpbmQoJy50b3RhbC1jYWxvcmllcycpO1xuICAgICAgdGhpcy50b3RhbEZhdEVsID0gdGhpcy4kZWwuZmluZCgnLnRvdGFsLWZhdCcpO1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzID0gMDtcbiAgICAgIHRoaXMudG90YWxGYXQgPSAwO1xuXG4gICAgICBmb29kQ29sbGVjdGlvbiA9IG5ldyBIVENvbGxlY3Rpb25zLkZvb2RDb2xsZWN0aW9uKCk7XG5cbiAgICAgIHNlYXJjaFZpZXcgPSBuZXcgU2VhcmNoVmlldygpO1xuICAgICAgZm9vZExpc3RWaWV3ID0gbmV3IEZvb2RMaXN0VmlldygpO1xuXG4gICAgICB0aGlzLmxpc3RlblRvKGZvb2RDb2xsZWN0aW9uLCAnYWRkJywgdGhpcy5hZGRTdGF0cyk7XG4gICAgICB0aGlzLmxpc3RlblRvKGZvb2RDb2xsZWN0aW9uLCAncmVtb3ZlJywgdGhpcy5zdWJ0cmFjdFN0YXRzKTtcblxuICAgICAgdmFyIHN0b3JlZFN0YXRlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hlYWx0aFRyYWNrZXJGb29kTGlzdCcpO1xuICAgICAgaWYgKHN0b3JlZFN0YXRlKSB7XG4gICAgICAgIHRoaXMubG9hZFN0YXRlKHN0b3JlZFN0YXRlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudG90YWxDYWxvcmllc0VsLmh0bWwodGhpcy50b3RhbENhbG9yaWVzICsgJyBjYWwnKTtcbiAgICAgIHRoaXMudG90YWxGYXRFbC5odG1sKHRoaXMudG90YWxGYXQgKyAnIGcnKTtcbiAgICB9LFxuXG4gICAgYWRkU3RhdHM6IGZ1bmN0aW9uKGZvb2RJdGVtKSB7XG4gICAgICB0aGlzLnRvdGFsQ2Fsb3JpZXMgKz0gZm9vZEl0ZW0uZ2V0KCdjYWxvcmllcycpO1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzRWwuaHRtbCh0aGlzLnRvdGFsQ2Fsb3JpZXMgKyAnIGNhbCcpO1xuICAgICAgdGhpcy50b3RhbEZhdCArPSBmb29kSXRlbS5nZXQoJ2ZhdCcpO1xuICAgICAgdGhpcy50b3RhbEZhdEVsLmh0bWwodGhpcy50b3RhbEZhdCArICcgZycpO1xuICAgIH0sXG5cbiAgICBzdWJ0cmFjdFN0YXRzOiBmdW5jdGlvbihmb29kSXRlbSkge1xuICAgICAgdGhpcy50b3RhbENhbG9yaWVzIC09IGZvb2RJdGVtLmdldCgnY2Fsb3JpZXMnKTtcbiAgICAgIHRoaXMudG90YWxDYWxvcmllc0VsLmh0bWwodGhpcy50b3RhbENhbG9yaWVzICsgJyBjYWwnKTtcbiAgICAgIHRoaXMudG90YWxGYXQgLT0gZm9vZEl0ZW0uZ2V0KCdmYXQnKTtcbiAgICAgIHRoaXMudG90YWxGYXRFbC5odG1sKHRoaXMudG90YWxGYXQgKyAnIGcnKTtcbiAgICB9LFxuXG4gICAgbG9hZFN0YXRlOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgdmFyIGZvb2RJdGVtcyA9IEpTT04ucGFyc2Uoc3RhdGUpO1xuICAgICAgdmFyIGZvb2RJdGVtO1xuICAgICAgXy5mb3JFYWNoKGZvb2RJdGVtcywgZnVuY3Rpb24oZmkpIHtcbiAgICAgICAgZm9vZEl0ZW0gPSBuZXcgSFRNb2RlbHMuRm9vZEl0ZW0oe1xuICAgICAgICAgIG5hbWU6IGZpLm5hbWUsXG4gICAgICAgICAgY2Fsb3JpZXM6IGZpLmNhbG9yaWVzLFxuICAgICAgICAgIGZhdDogZmkuZmF0LFxuICAgICAgICAgIHRodW1ibmFpbFVSTDogZmkudGh1bWJuYWlsVVJMXG4gICAgICAgIH0pO1xuICAgICAgICBmb29kQ29sbGVjdGlvbi5hZGQoZm9vZEl0ZW0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIEhlYWx0aCBUcmFja2VyIGFwcGxpY2F0aW9uLlxuICAgKiBAZnVuY3Rpb25cbiAgICogQG1lbWJlcm9mIEhlYWx0aFRyYWNrZXIuVmlld3N+XG4gICAqL1xuICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFwcCA9IG5ldyBBcHAoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQ6IGluaXRcbiAgfTtcbn0pKCk7XG5cbkhlYWx0aFRyYWNrZXIuVmlld3MuaW5pdCgpO1xuIl19
